<UserControl x:Class="MemoryGardenWPF.Views.GameView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:MemoryGardenWPF.ViewModels"
             x:Name="Root">
  <Grid Background="#F0F4FF">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- Top HUD -->
    <Border Grid.Row="0" Margin="24" Padding="8" CornerRadius="24" Background="White" BorderBrush="#E5E7EB" BorderThickness="1">
      <DockPanel>
        <Button Content="← Menu" Command="{Binding BackToMenuCommand}" Margin="4"/>
        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" DockPanel.Dock="Top" >
          <TextBlock Text="Pairs: " FontWeight="SemiBold"/>
          <TextBlock Text="{Binding FoundPairs}" FontWeight="Bold"/>
          <TextBlock Text="/"/>
          <TextBlock Text="{Binding PairsTarget}"/>
          <TextBlock Text="   •   Moves: "/>
          <TextBlock Text="{Binding Moves}"/>
          <TextBlock Text="   •   Time: "/>
          <TextBlock Text="{Binding TimeText}"/>
        </StackPanel>
      </DockPanel>
    </Border>

    <!-- Board -->
    <Grid Grid.Row="1">
      <Border Margin="24" Padding="16" CornerRadius="32" Background="White" BorderBrush="#E5E7EB" BorderThickness="1">
        <Grid>
          <ItemsControl ItemsSource="{Binding Deck}">
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <UniformGrid Rows="{Binding Rows}" Columns="{Binding Cols}" />
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
              <DataTemplate DataType="{x:Type vm:CardViewModel}">
                <Button Command="{Binding FlipCommand}" Margin="6" Height="100" Width="100">
                  <Button.Style>
                    <Style TargetType="Button">
                      <Setter Property="Template">
                        <Setter.Value>
                          <ControlTemplate TargetType="Button">
                            <Grid>
                              <!-- Face-up -->
                              <Border x:Name="Face" CornerRadius="18" Background="White" BorderBrush="#D1D5DB" BorderThickness="1" >
                                <TextBlock Text="{Binding Emoji}" FontSize="36" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                              </Border>
                              <!-- Back -->
                              <Border x:Name="Back" CornerRadius="18" Background="#F3F4F6" BorderBrush="#E5E7EB" BorderThickness="1" Visibility="Collapsed">
                                <TextBlock Text="🌼" FontSize="24" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                              </Border>
                            </Grid>
                            <ControlTemplate.Triggers>
                              <DataTrigger Binding="{Binding IsFaceUp}" Value="False">
                                <Setter TargetName="Face" Property="Visibility" Value="Collapsed"/>
                                <Setter TargetName="Back" Property="Visibility" Value="Visible"/>
                              </DataTrigger>
                              <DataTrigger Binding="{Binding IsMatched}" Value="True">
                                <Setter TargetName="Face" Property="BorderBrush" Value="#86EFAC"/>
                                <Setter TargetName="Face" Property="Background" Value="#ECFDF5"/>
                              </DataTrigger>
                            </ControlTemplate.Triggers>
                          </ControlTemplate>
                        </Setter.Value>
                      </Setter>
                    </Style>
                  </Button.Style>
                </Button>
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>

          <!-- Overlay: Countdown & Win -->
          <Border Background="#AAFFFFFF" Visibility="{Binding IsPreviewing, Converter={StaticResource BoolToVis}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
              <TextBlock Text="{Binding Countdown}" FontSize="72" FontWeight="Black" Foreground="#0EA5E9" HorizontalAlignment="Center"/>
              <TextBlock Text="Look and remember the pairs!" HorizontalAlignment="Center"/>
            </StackPanel>
          </Border>

          <Border Background="#AAFFFFFF" Visibility="{Binding Won, Converter={StaticResource BoolToVis}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
              <TextBlock Text="You did it!" FontSize="32" FontWeight="Black" HorizontalAlignment="Center"/>
              <TextBlock Text="{Binding TimeText, StringFormat=Time: {0}}" HorizontalAlignment="Center" Margin="0,4,0,0"/>
              <TextBlock Text="{Binding Moves, StringFormat=Moves: {0}}" HorizontalAlignment="Center" Margin="0,2,0,0"/>
              <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,8,0,0">
                <Button Content="Play Again" Command="{Binding NewGameCommand}" Margin="0,0,8,0"/>
                <Button Content="Menu" Command="{Binding BackToMenuCommand}" />
              </StackPanel>
            </StackPanel>
          </Border>
        </Grid>
      </Border>
    </Grid>

    <!-- Bottom: Peek -->
    <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="24">
      <Button Content="Peek" Command="{Binding PeekCommand}" Width="140" Height="40"/>
      <TextBlock Text="  " />
      <TextBlock Text="{Binding PeekLeft, StringFormat=({0} left)}" VerticalAlignment="Center" />
    </StackPanel>
  </Grid>
</UserControl>
